{"ast":null,"code":"var _jsxFileName = \"/Users/bradwilliams/EatSafely/client/src/pages/ScanImage.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport ScanFirst from \"./scan_first\";\nimport ScanResult from \"./scan_result\";\nimport ScanLoading from \"./scan_loading\";\nimport \"./ScanImage.scss\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Tesseract = require(\"tesseract.js\");\nfunction ScanImage(_ref) {\n  _s();\n  let {\n    intolerances\n  } = _ref;\n  // Page state\n  const [scanState, setscanState] = useState({\n    page: \"first\",\n    loading: false\n  });\n  // Ocr data states\n  const [ocrState, setOcrState] = useState({\n    text: \"\",\n    array: []\n  });\n  // Loading states\n  const [loading, isLoading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [confidence, setConfidence] = useState();\n  const [imagePath, setImagePath] = useState(\"\");\n\n  // Upload file event handler\n  const handleChange = event => {\n    setImagePath(URL.createObjectURL(event.target.files[0]));\n  };\n\n  // UseEffect for testing\n  useEffect(() => {\n    console.log(scanState);\n    // searchText([\"Wheat\", \"cake\"], intolerances);\n    console.log(ocrState.text);\n  }, [scanState, ocrState.text]);\n\n  // Scan image onClick event handler\n  const handleClick = () => {\n    // Change page state to loading\n    setscanState(prev => ({\n      ...prev,\n      loading: true\n    }));\n\n    // Start tesseract OCR\n    Tesseract.recognize(imagePath, \"eng\", {\n      logger: m => {\n        m.progress < 1 ? isLoading(true) : isLoading(false);\n        setProgress(m.progress);\n      }\n    }).catch(err => {\n      console.error(err);\n    }).then(result => {\n      // Get Confidence score\n      let confidenceResult = result.data.confidence;\n      setConfidence(confidenceResult);\n      let text = result.data.text;\n      if (confidenceResult < 55) {\n        return setOcrState(prev => ({\n          ...prev,\n          img: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"https://www.gran-turismo.com/gtsport/decal/5845681194092494864_1.png\",\n            alt: \"warning\",\n            className: \"checkmark\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 15\n          }, this)\n        }));\n      } else {\n        setOcrState(prev => ({\n          ...prev,\n          text,\n          array: confidentTextArray(result),\n          img: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"https://www.gran-turismo.com/gtsport/decal/5845681194092494864_1.png\",\n            alt: \"warning\",\n            className: \"checkmark\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 15\n          }, this)\n        }));\n      }\n    });\n\n    // Change scanState to view results\n    setscanState(prev => ({\n      ...prev,\n      page: \"result\",\n      loading: false\n    }));\n  };\n\n  // returns array of text where each word is above a % of confidence\n  function confidentTextArray(result) {\n    const returnArray = [];\n    const wordArray = result.data.words;\n    wordArray.forEach(word => {\n      if (word.confidence >= 65) {\n        returnArray.push(word.text);\n      }\n    });\n    return returnArray;\n  }\n\n  // Back/retry button\n\n  function backButton() {\n    setscanState(prev => ({\n      ...prev,\n      page: \"first\"\n    }));\n    setOcrState(prev => ({\n      ...prev,\n      text: \"\",\n      array: []\n    }));\n  }\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    className: \"layout\",\n    children: /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"ocr\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"instructions\",\n        children: \"Please upload an image to scan\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: imagePath && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: imagePath,\n          alt: \"Upload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 28\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 9\n      }, this), !loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-box\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 13\n        }, this), \"Loading \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"progress\", {\n          value: progress\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 11\n      }, this), confidence < 55 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"The confidence score of this scan is: \", confidence, \"% \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 65\n        }, this), \"Please take a more clear picture to get more confident results...\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }, this), scanState.page === \"first\" && /*#__PURE__*/_jsxDEV(ScanFirst, {\n        intolerances: intolerances,\n        setOcrState: setOcrState,\n        handleClick: handleClick,\n        setConfidence: setConfidence,\n        handleChange: handleChange,\n        setImagePath: setImagePath\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 11\n      }, this), scanState.page === \"result\" && /*#__PURE__*/_jsxDEV(ScanResult, {\n        intolerances: intolerances,\n        ocrState: ocrState,\n        confidence: confidence,\n        backButton: backButton\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 5\n  }, this);\n}\n_s(ScanImage, \"wHV2QHjSWAsAyKuKZXMv102VqVk=\");\n_c = ScanImage;\nexport default ScanImage;\nvar _c;\n$RefreshReg$(_c, \"ScanImage\");","map":{"version":3,"names":["useState","useEffect","ScanFirst","ScanResult","ScanLoading","Tesseract","require","ScanImage","intolerances","scanState","setscanState","page","loading","ocrState","setOcrState","text","array","isLoading","progress","setProgress","confidence","setConfidence","imagePath","setImagePath","handleChange","event","URL","createObjectURL","target","files","console","log","handleClick","prev","recognize","logger","m","catch","err","error","then","result","confidenceResult","data","img","confidentTextArray","returnArray","wordArray","words","forEach","word","push","backButton"],"sources":["/Users/bradwilliams/EatSafely/client/src/pages/ScanImage.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport ScanFirst from \"./scan_first\";\nimport ScanResult from \"./scan_result\";\nimport ScanLoading from \"./scan_loading\";\nimport \"./ScanImage.scss\";\nconst Tesseract = require(\"tesseract.js\");\n\nfunction ScanImage({ intolerances }) {\n  // Page state\n  const [scanState, setscanState] = useState({\n    page: \"first\",\n    loading: false,\n  });\n  // Ocr data states\n  const [ocrState, setOcrState] = useState({\n    text: \"\",\n    array: [],\n  });\n  // Loading states\n  const [loading, isLoading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [confidence, setConfidence] = useState();\n  const [imagePath, setImagePath] = useState(\"\");\n\n  // Upload file event handler\n  const handleChange = (event) => {\n    setImagePath(URL.createObjectURL(event.target.files[0]));\n  };\n\n  // UseEffect for testing\n  useEffect(() => {\n    console.log(scanState);\n    // searchText([\"Wheat\", \"cake\"], intolerances);\n    console.log(ocrState.text);\n  }, [scanState, ocrState.text]);\n\n  // Scan image onClick event handler\n  const handleClick = () => {\n    // Change page state to loading\n    setscanState((prev) => ({\n      ...prev,\n      loading: true,\n    }));\n\n    // Start tesseract OCR\n    Tesseract.recognize(imagePath, \"eng\", {\n      logger: (m) => {\n        m.progress < 1 ? isLoading(true) : isLoading(false);\n        setProgress(m.progress);\n      },\n    })\n      .catch((err) => {\n        console.error(err);\n      })\n      .then((result) => {\n        // Get Confidence score\n        let confidenceResult = result.data.confidence;\n        setConfidence(confidenceResult);\n        let text = result.data.text;\n\n        if (confidenceResult < 55) {\n          return setOcrState((prev) => ({\n            ...prev,\n            img: (\n              <img\n                src=\"https://www.gran-turismo.com/gtsport/decal/5845681194092494864_1.png\"\n                alt=\"warning\"\n                className=\"checkmark\"\n              />\n            ),\n          }));\n        } else {\n          setOcrState((prev) => ({\n            ...prev,\n            text,\n            array: confidentTextArray(result),\n            img: (\n              <img\n                src=\"https://www.gran-turismo.com/gtsport/decal/5845681194092494864_1.png\"\n                alt=\"warning\"\n                className=\"checkmark\"\n              />\n            ),\n          }));\n        }\n      });\n\n    // Change scanState to view results\n    setscanState((prev) => ({\n      ...prev,\n      page: \"result\",\n      loading: false,\n    }));\n  };\n\n  // returns array of text where each word is above a % of confidence\n  function confidentTextArray(result) {\n    const returnArray = [];\n    const wordArray = result.data.words;\n\n    wordArray.forEach((word) => {\n      if (word.confidence >= 65) {\n        returnArray.push(word.text);\n      }\n    });\n\n    return returnArray;\n  }\n\n  // Back/retry button\n\n  function backButton() {\n    setscanState((prev) => ({\n      ...prev,\n      page: \"first\",\n    }));\n\n    setOcrState((prev) => ({\n      ...prev,\n      text: \"\",\n      array: [],\n    }));\n  }\n\n  return (\n    <main className=\"layout\">\n      <section className=\"ocr\">\n        <h3 className=\"instructions\">Please upload an image to scan</h3>\n\n        {/* View uploaded image */}\n        <div>{imagePath && <img src={imagePath} alt=\"Upload\" />}</div>\n\n        {/* Loading state */}\n        {!loading ? (\n          <div className=\"text-box\"></div>\n        ) : (\n          <label>\n            <br />\n            <br />\n            Loading <br />\n            <progress value={progress}></progress>\n          </label>\n        )}\n\n        {/* Confidence state */}\n        {confidence < 55 ? (\n          <p>\n            The confidence score of this scan is: {confidence}% <br />\n            Please take a more clear picture to get more confident results...\n          </p>\n        ) : (\n          <p></p>\n        )}\n\n        {/* Results rendering */}\n\n        {scanState.page === \"first\" && (\n          <ScanFirst\n            intolerances={intolerances}\n            setOcrState={setOcrState}\n            handleClick={handleClick}\n            setConfidence={setConfidence}\n            handleChange={handleChange}\n            setImagePath={setImagePath}\n          ></ScanFirst>\n        )}\n\n        {/* {scanState.loading === true && <Scan_loading progress={progress} loading={loading}></Scan_loading>} */}\n        {scanState.page === \"result\" && (\n          <ScanResult\n            intolerances={intolerances}\n            ocrState={ocrState}\n            confidence={confidence}\n            backButton={backButton}\n          ></ScanResult>\n        )}\n      </section>\n    </main>\n  );\n}\n\nexport default ScanImage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}